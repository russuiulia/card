<!DOCTYPE html>

<html class="h-full bg-white">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <title>Transaction authorization</title>

    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <meta name="format-detection" content="telephone=no" />

    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="images/maib/images/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="images/maib/images/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="images/maib/images/favicon-16x16.png"
    />
    <link rel="manifest" href="images/maib/webmanifest/site.webmanifest" />
    <link
      rel="mask-icon"
      href="images/maib/images/safari-pinned-tab.svg"
      color="#40c1ac"
    />

    <link rel="shortcut icon" href="images/maib/images/favicon.ico" />
    %%javascript%% %%applepay_js%% %%applepay_css%% %%googlepay_js%%
    <link rel="stylesheet" type="text/css" href="images/maib/css/iasig.css" />
    <style>
      html,
      body {
        -webkit-overflow-scrolling: touch !important;
        overflow: auto !important;
        height: 100% !important;
      }

      .form__col_error {
        color: red;
        font-size: 11px;
        position: absolute;
      }
      .form__col_cvc .form__col_error {
        max-width: 120px;
      }
      .number-input {
        background-position: -moz-calc(100% - 20px) 50%;
        background-position: calc(100% - 20px) 50%;
        background-repeat: no-repeat;
      }
      .number-input[data-card-type='visa'] {
        background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg width='28' height='10' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M13.86 1.03 12 8.99H9.73l1.87-7.96h2.26Zm9.52 5.14 1.2-2.99.68 3h-1.88ZM25.91 9H28l-1.83-7.96h-1.93c-.43 0-.8.23-.96.58L19.88 9h2.38l.47-1.19h2.9l.28 1.2ZM20 6.4c0-2.1-3.2-2.22-3.18-3.16 0-.28.3-.59.96-.66a4.65 4.65 0 0 1 2.23.35l.4-1.69A6.63 6.63 0 0 0 18.3.88c-2.23 0-3.8 1.08-3.82 2.63-.01 1.15 1.12 1.8 1.98 2.17.88.4 1.18.64 1.17 1 0 .53-.7.76-1.35.77-1.14.02-1.8-.28-2.32-.5l-.41 1.75c.53.22 1.5.4 2.51.42 2.38 0 3.93-1.07 3.94-2.73Zm-9.38-5.36L6.96 8.99H4.57l-1.8-6.35c-.11-.4-.2-.54-.54-.7C1.7 1.67.8 1.42 0 1.26l.05-.23H3.9c.5 0 .93.3 1.05.8l.95 4.62 2.35-5.42h2.38Z' fill='%231A1F71'/%3E%3C/svg%3E");
        background-position-y: 50%;
      }

      .number-input[data-card-type='mastercard'] {
        background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg width='23' height='16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.6 2.5H8.38v11h6.22v-11Z' fill='%23FF5A00'/%3E%3Cpath d='M8.8 8a6.99 6.99 0 0 1 2.7-5.5A7.14 7.14 0 0 0 0 8a7.14 7.14 0 0 0 11.5 5.5A6.95 6.95 0 0 1 8.8 8Z' fill='%23EB001B'/%3E%3Cpath d='M23 8a7.14 7.14 0 0 1-11.5 5.5 6.93 6.93 0 0 0 0-11A7.13 7.13 0 0 1 15.88 1 7.07 7.07 0 0 1 23 8Z' fill='%23F79E1B'/%3E%3C/svg%3E");
      }

      .number-input[data-card-type='amex'] {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='25px' height='25px' viewBox='0 0 40 39' version='1.1'%3E%3Cg id='surface1'%3E%3Cpath style=' stroke:none;fill-rule:nonzero;fill:rgb(0.392157%25,43.529412%25,81.568627%25);fill-opacity:1;' d='M 0 0 L 39.902344 0 L 39.902344 21.042969 L 37.925781 24.058594 L 39.902344 26.742188 L 39.902344 38.980469 L 0 38.980469 L 0 19.144531 L 1.234375 17.757812 L 0 16.429688 Z M 0 0 '/%3E%3Cpath style=' stroke:none;fill-rule:nonzero;fill:rgb(100%25,100%25,100%25);fill-opacity:1;' d='M 7.746094 27.164062 L 7.746094 21.042969 L 14.378906 21.042969 L 15.089844 21.949219 L 15.824219 21.042969 L 39.902344 21.042969 L 39.902344 26.742188 C 39.902344 26.742188 39.269531 27.15625 38.542969 27.164062 L 25.210938 27.164062 L 24.410156 26.199219 L 24.410156 27.164062 L 21.78125 27.164062 L 21.78125 25.515625 C 21.78125 25.515625 21.421875 25.746094 20.644531 25.746094 L 19.75 25.746094 L 19.75 27.164062 L 15.769531 27.164062 L 15.058594 26.238281 L 14.335938 27.164062 Z M 7.746094 27.164062 '/%3E%3Cpath style=' stroke:none;fill-rule:nonzero;fill:rgb(100%25,100%25,100%25);fill-opacity:1;' d='M 0 16.429688 L 1.496094 13.023438 L 4.082031 13.023438 L 4.929688 14.933594 L 4.929688 13.023438 L 8.148438 13.023438 L 8.652344 14.402344 L 9.140625 13.023438 L 23.578125 13.023438 L 23.578125 13.71875 C 23.578125 13.71875 24.335938 13.023438 25.582031 13.023438 L 30.265625 13.039062 L 31.101562 14.921875 L 31.101562 13.023438 L 33.789062 13.023438 L 34.53125 14.105469 L 34.53125 13.023438 L 37.246094 13.023438 L 37.246094 19.144531 L 34.53125 19.144531 L 33.820312 18.058594 L 33.820312 19.144531 L 29.867188 19.144531 L 29.46875 18.179688 L 28.40625 18.179688 L 28.015625 19.144531 L 25.335938 19.144531 C 24.261719 19.144531 23.578125 18.464844 23.578125 18.464844 L 23.578125 19.144531 L 19.535156 19.144531 L 18.730469 18.179688 L 18.730469 19.144531 L 3.699219 19.144531 L 3.300781 18.179688 L 2.242188 18.179688 L 1.847656 19.144531 L 0 19.144531 Z M 0 16.429688 '/%3E%3Cpath style=' stroke:none;fill-rule:nonzero;fill:rgb(0.392157%25,43.529412%25,81.568627%25);fill-opacity:1;' d='M 2.023438 13.777344 L 0.0078125 18.359375 L 1.320312 18.359375 L 1.695312 17.441406 L 3.855469 17.441406 L 4.226562 18.359375 L 5.570312 18.359375 L 3.554688 13.777344 Z M 2.773438 14.84375 L 3.429688 16.449219 L 2.109375 16.449219 Z M 2.773438 14.84375 '/%3E%3Cpath style=' stroke:none;fill-rule:nonzero;fill:rgb(0.392157%25,43.529412%25,81.568627%25);fill-opacity:1;' d='M 5.707031 18.359375 L 5.707031 13.777344 L 7.574219 13.785156 L 8.660156 16.738281 L 9.71875 13.777344 L 11.570312 13.777344 L 11.570312 18.359375 L 10.398438 18.359375 L 10.398438 14.984375 L 9.15625 18.359375 L 8.128906 18.359375 L 6.882812 14.984375 L 6.882812 18.359375 Z M 5.707031 18.359375 '/%3E%3Cpath style=' stroke:none;fill-rule:nonzero;fill:rgb(0.392157%25,43.529412%25,81.568627%25);fill-opacity:1;' d='M 12.375 18.359375 L 12.375 13.777344 L 16.199219 13.777344 L 16.199219 14.800781 L 13.558594 14.800781 L 13.558594 15.585938 L 16.140625 15.585938 L 16.140625 16.550781 L 13.558594 16.550781 L 13.558594 17.363281 L 16.199219 17.363281 L 16.199219 18.359375 Z M 12.375 18.359375 '/%3E%3Cpath style=' stroke:none;fill-rule:nonzero;fill:rgb(0.392157%25,43.529412%25,81.568627%25);fill-opacity:1;' d='M 16.878906 13.777344 L 16.878906 18.359375 L 18.050781 18.359375 L 18.050781 16.734375 L 18.546875 16.734375 L 19.953125 18.359375 L 21.386719 18.359375 L 19.84375 16.671875 C 20.476562 16.621094 21.128906 16.089844 21.128906 15.265625 C 21.128906 14.300781 20.355469 13.777344 19.488281 13.777344 Z M 18.050781 14.804688 L 19.394531 14.804688 C 19.714844 14.804688 19.949219 15.050781 19.949219 15.285156 C 19.949219 15.589844 19.644531 15.769531 19.410156 15.769531 L 18.050781 15.769531 Z M 18.050781 14.804688 '/%3E%3Cpath style=' stroke:none;fill-rule:nonzero;fill:rgb(0.392157%25,43.529412%25,81.568627%25);fill-opacity:1;' d='M 22.804688 18.359375 L 21.609375 18.359375 L 21.609375 13.777344 L 22.804688 13.777344 Z M 22.804688 18.359375 '/%3E%3Cpath style=' stroke:none;fill-rule:nonzero;fill:rgb(0.392157%25,43.529412%25,81.568627%25);fill-opacity:1;' d='M 25.644531 18.359375 L 25.386719 18.359375 C 24.136719 18.359375 23.375 17.398438 23.375 16.085938 C 23.375 14.746094 24.125 13.777344 25.707031 13.777344 L 27 13.777344 L 27 14.863281 L 25.65625 14.863281 C 25.015625 14.863281 24.5625 15.351562 24.5625 16.097656 C 24.5625 16.988281 25.082031 17.359375 25.828125 17.359375 L 26.136719 17.359375 Z M 25.644531 18.359375 '/%3E%3Cpath style=' stroke:none;fill-rule:nonzero;fill:rgb(0.392157%25,43.529412%25,81.568627%25);fill-opacity:1;' d='M 28.195312 13.777344 L 26.179688 18.359375 L 27.492188 18.359375 L 27.863281 17.441406 L 30.027344 17.441406 L 30.398438 18.359375 L 31.742188 18.359375 L 29.726562 13.777344 Z M 28.941406 14.84375 L 29.601562 16.449219 L 28.28125 16.449219 Z M 28.941406 14.84375 '/%3E%3Cpath style=' stroke:none;fill-rule:nonzero;fill:rgb(0.392157%25,43.529412%25,81.568627%25);fill-opacity:1;' d='M 31.878906 18.359375 L 31.878906 13.777344 L 33.367188 13.777344 L 35.273438 16.65625 L 35.273438 13.777344 L 36.445312 13.777344 L 36.445312 18.359375 L 35 18.359375 L 33.050781 15.40625 L 33.050781 18.359375 Z M 31.878906 18.359375 '/%3E%3Cpath style=' stroke:none;fill-rule:nonzero;fill:rgb(0.392157%25,43.529412%25,81.568627%25);fill-opacity:1;' d='M 8.546875 26.378906 L 8.546875 21.796875 L 12.375 21.796875 L 12.375 22.820312 L 9.734375 22.820312 L 9.734375 23.605469 L 12.3125 23.605469 L 12.3125 24.570312 L 9.734375 24.570312 L 9.734375 25.382812 L 12.375 25.382812 L 12.375 26.378906 Z M 8.546875 26.378906 '/%3E%3Cpath style=' stroke:none;fill-rule:nonzero;fill:rgb(0.392157%25,43.529412%25,81.568627%25);fill-opacity:1;' d='M 27.296875 26.378906 L 27.296875 21.796875 L 31.125 21.796875 L 31.125 22.820312 L 28.484375 22.820312 L 28.484375 23.605469 L 31.050781 23.605469 L 31.050781 24.570312 L 28.484375 24.570312 L 28.484375 25.382812 L 31.125 25.382812 L 31.125 26.378906 Z M 27.296875 26.378906 '/%3E%3Cpath style=' stroke:none;fill-rule:nonzero;fill:rgb(0.392157%25,43.529412%25,81.568627%25);fill-opacity:1;' d='M 12.523438 26.378906 L 14.386719 24.117188 L 12.480469 21.796875 L 13.957031 21.796875 L 15.09375 23.230469 L 16.230469 21.796875 L 17.652344 21.796875 L 15.769531 24.089844 L 17.636719 26.378906 L 16.160156 26.378906 L 15.054688 24.96875 L 13.980469 26.378906 Z M 12.523438 26.378906 '/%3E%3Cpath style=' stroke:none;fill-rule:nonzero;fill:rgb(0.392157%25,43.529412%25,81.568627%25);fill-opacity:1;' d='M 17.773438 21.796875 L 17.773438 26.378906 L 18.976562 26.378906 L 18.976562 24.933594 L 20.210938 24.933594 C 21.257812 24.933594 22.046875 24.390625 22.046875 23.339844 C 22.046875 22.46875 21.429688 21.796875 20.363281 21.796875 Z M 18.976562 22.832031 L 20.277344 22.832031 C 20.617188 22.832031 20.855469 23.035156 20.855469 23.363281 C 20.855469 23.667969 20.617188 23.890625 20.273438 23.890625 L 18.976562 23.890625 Z M 18.976562 22.832031 '/%3E%3Cpath style=' stroke:none;fill-rule:nonzero;fill:rgb(0.392157%25,43.529412%25,81.568627%25);fill-opacity:1;' d='M 22.558594 21.796875 L 22.558594 26.378906 L 23.730469 26.378906 L 23.730469 24.75 L 24.222656 24.75 L 25.628906 26.378906 L 27.0625 26.378906 L 25.519531 24.691406 C 26.152344 24.640625 26.808594 24.109375 26.808594 23.285156 C 26.808594 22.320312 26.03125 21.796875 25.167969 21.796875 Z M 23.730469 22.820312 L 25.070312 22.820312 C 25.390625 22.820312 25.625 23.066406 25.625 23.304688 C 25.625 23.609375 25.324219 23.785156 25.089844 23.785156 L 23.730469 23.785156 Z M 23.730469 22.820312 '/%3E%3Cpath style=' stroke:none;fill-rule:nonzero;fill:rgb(0.392157%25,43.529412%25,81.568627%25);fill-opacity:1;' d='M 31.667969 26.378906 L 31.667969 25.382812 L 34.015625 25.382812 C 34.363281 25.382812 34.511719 25.199219 34.511719 25 C 34.511719 24.808594 34.363281 24.613281 34.015625 24.613281 L 32.953125 24.613281 C 32.03125 24.613281 31.519531 24.0625 31.519531 23.238281 C 31.519531 22.503906 31.988281 21.796875 33.359375 21.796875 L 35.640625 21.796875 L 35.148438 22.828125 L 33.171875 22.828125 C 32.796875 22.828125 32.679688 23.019531 32.679688 23.207031 C 32.679688 23.394531 32.824219 23.605469 33.113281 23.605469 L 34.222656 23.605469 C 35.25 23.605469 35.695312 24.175781 35.695312 24.921875 C 35.695312 25.722656 35.199219 26.378906 34.167969 26.378906 Z M 31.667969 26.378906 '/%3E%3Cpath style=' stroke:none;fill-rule:nonzero;fill:rgb(0.392157%25,43.529412%25,81.568627%25);fill-opacity:1;' d='M 35.972656 26.378906 L 35.972656 25.382812 L 38.316406 25.382812 C 38.664062 25.382812 38.816406 25.199219 38.816406 25 C 38.816406 24.808594 38.664062 24.613281 38.316406 24.613281 L 37.257812 24.613281 C 36.335938 24.613281 35.824219 24.0625 35.824219 23.238281 C 35.824219 22.503906 36.292969 21.796875 37.664062 21.796875 L 39.945312 21.796875 L 39.453125 22.828125 L 37.476562 22.828125 C 37.101562 22.828125 36.984375 23.019531 36.984375 23.207031 C 36.984375 23.394531 37.128906 23.605469 37.414062 23.605469 L 38.527344 23.605469 C 39.554688 23.605469 40 24.175781 40 24.921875 C 40 25.722656 39.503906 26.378906 38.46875 26.378906 Z M 35.972656 26.378906 '/%3E%3C/g%3E%3C/svg%3E");
      }
      input:focus {
        scroll-margin-bottom: 200px;
      }
    </style>
  </head>
  <body class="h-full">
    <main class="lg:flex lg:min-h-full lg:flex-row-reverse lg:overflow-hidden">
      <!-- <h1 class="sr-only">Checkout</h1> -->

      <section
        aria-labelledby="payment-heading"
        class="flex-auto overflow-y-auto px-4 pt-12 pb-16 sm:px-6 sm:pt-16 lg:px-8 lg:pt-0 lg:pb-24"
      >
        <div class="mx-auto max-w-lg lg:pt-16">
          <div class="bg-gray-100 p-4 mb-5 rounded-md text-sm/6">
            <div class="flex justify-between font-semibold">
              <div>Amount:</div>
              <div>%%amount%%&nbsp;%%ccyalpha%%</div>
            </div>
            <div class="flex justify-between">
              <div>Description:</div>
              <div>%%description%%</div>
            </div>
          </div>

          %%formdef%%
          <form class="mt-6">
            <div lang="en" class="apple-pay-button"></div>
            <div id="google-pay-button" data-color="default"></div>

            <div class="relative mt-8">
              <div
                class="absolute inset-0 flex items-center"
                aria-hidden="true"
              >
                <div class="w-full border-t border-gray-200"></div>
              </div>
              <div class="relative flex justify-center">
                <span class="bg-white px-4 text-sm font-medium text-gray-500"
                  >or</span
                >
              </div>
            </div>

            <div class="grid grid-cols-12 gap-x-4 gap-y-6">
              <div class="col-span-full">
                <label
                  for="cardname"
                  class="block text-sm/6 font-medium text-gray-700"
                  >Name / Surname</label
                >
                <div class="form__col mt-2">
                  <input
                    oninput="lettersOnly(this)"
                    name="cardname"
                    id="cardname"
                    type="text"
                    placeholder="Ex: Ion Popa"
                    autocomplete="off"
                    autocapitalize="off"
                    autocorrect="off"
                    required
                    maxlength="100"
                    class="form__input block w-full rounded-md bg-white px-3 py-2 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-emerald-500 sm:text-sm/6"
                  />
                </div>
              </div>
              <div class="form__col col-span-full">
                <label
                  for="cardnr"
                  class="block text-sm/6 font-medium text-gray-700"
                  >Card number</label
                >
                <div class="mt-2">
                  <input
                    type="text"
                    name="cardnr"
                    id="cardnr"
                    inputmode="numeric"
                    placeholder="XXXX XXXX XXXX XXXX"
                    autocomplete="cc-number"
                    autocapitalize="off"
                    autocorrect="off"
                    required
                    maxlength="19"
                    size="19"
                    class="form__input number-input block w-full rounded-md bg-white px-3 py-2 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-emerald-500 sm:text-sm/6"
                  />
                </div>
              </div>

              <div class="col-span-7 sm:col-span-8">
                <label
                  for="expiryDate"
                  class="block text-sm/6 font-medium text-gray-700"
                  >Expiration date (MM/YY)</label
                >
                <div class="mt-2 form__col form__col_expiration">
                  <div style="display: none; visibility: hidden">
                    <input
                      hidden
                      name="validMONTH"
                      id="validMONTH"
                      autocomplete="cc-exp-month"
                    />

                    <input
                      hidden
                      name="validYEAR"
                      id="validYEAR"
                      autocomplete="cc-exp-year"
                    />
                  </div>
                  <input
                    id="expiryDate"
                    type="tel"
                    placeholder="MM/YY"
                    autocomplete="cc-exp"
                    autocapitalize="off"
                    autocorrect="off"
                    required
                    minlength="5"
                    maxlength="5"
                    class="form__input expiry-input block w-full rounded-md bg-white px-3 py-2 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-emerald-500 sm:text-sm/6"
                  />
                </div>
              </div>
              <div class="col-span-5 sm:col-span-4">
                <label
                  class="block text-sm/6 font-medium text-gray-700"
                  for="cvc2"
                  >Security code</label
                >
                <div class="mt-2 form__col form__col_cvc">
                  <input
                    name="cvc2"
                    id="cvc2"
                    type="password"
                    placeholder="CVC2/CVV2"
                    autocomplete="cc-csc"
                    autocapitalize="off"
                    autocorrect="off"
                    pattern="[0-9]*"
                    required
                    minlength="3"
                    maxlength="3"
                    class="form__input securitycode-input block w-full rounded-md bg-white px-3 py-2 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-emerald-500 sm:text-sm/6"
                    oninput="numbersOnly(this)"
                  />
                </div>
              </div>
            </div>
            <button
              id="submit_button"
              type="submit"
              class="mt-15 w-full rounded-md border border-transparent bg-[40c1ac] px-4 py-2 text-sm font-medium text-white shadow-xs hover:bg-[39af9c] focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 focus:outline-none"
            >
              Pay
            </button>
          </form>
          <div class="main__block_footer flex justify-between mt-5">
            <div class="footer__left_icons flex">
              <img
                src="images/maib/images/visa-secure.svg"
                alt="Visa secure"
                class="pr-3"
              />
              <img
                src="images/maib/images/mc-idcheck.svg"
                alt="Mastercard IDcheck"
              />
            </div>
            <img src="images/maib/images/3d-secure.svg" alt="3d secure" />
          </div>
        </div>
      </section>
    </main>

    <script defer src="images/maib/js/external-library.js"></script>

    <script>
      let inputProperties = {
        cardname: {
          errors: {
            required: 'Enter cardholder name',
          },
        },
        cardnr: {
          requiredLength: 19,
          errors: {
            required: 'Enter the card number',
            length: 'The card number should be 16 digits',
            invalid: 'Enter a valid card',
          },
        },
        expiryDate: {
          requiredLength: 5,
          errors: {
            required: 'Enter the card expiration date',
            length: 'Enter the card expiration date',
            value: 'Expired card',
          },
        },
        cvc2: {
          requiredLength: 3,
          errors: {
            required: 'Enter the CVV2/CVC2 code on the back of the card',
            length: 'CVC2/CVV2 code should be 3 characters',
          },
        },
      };
      let hasErrors = 0;
      let expirationDateMask;
      let cardNumberMask;
      const now = new Date();
      const curYear = now.getFullYear() - 2000;
      const curMonth = now.getMonth();

      function getElementsArray(cssSelector) {
        return Array.prototype.slice.call(
          document.querySelectorAll(cssSelector)
        );
      }

      function lettersOnly(input) {
        input.value = input.value.replace(/[^a-z- ]/gi, '');
      }

      function numbersOnly(input) {
        input.value = input.value.replace(/[^0-9]/gi, '');
      }

      function showCodeClick(element, hide) {
        if (!element)
          element = document.querySelector('.form__show-code-button');

        const input = element.previousElementSibling;

        if (input.type === 'text' || hide) {
          input.type = 'password';
          element.classList.remove('form__show-code-button_show');
        } else {
          input.type = 'text';
          element.classList.add('form__show-code-button_show');
        }
      }

      function showError($input, errorText) {
        const $inputWrapper = $input.closest('.form__col');
        const $inputError = $inputWrapper.querySelector('.form__col_error');
        const $inputOutline = $input.closest('.form__col input');
        $inputWrapper.classList.remove('has-value');

        if (!$inputError) {
          let $error = document.createElement('div');
          $error.classList.add('form__col_error');
          $inputWrapper.append($error);
          $error.innerHTML = errorText;
          $inputWrapper.classList.add('has-error');
          $inputOutline.classList.add('outline-red-500');
          hasErrors = hasErrors + 1;
        } else {
          $inputError.innerHTML = errorText;
        }
      }

      function hideError($input) {
        const $inputWrapper = $input.closest('.form__col');
        const $inputError = $inputWrapper.querySelector('.form__col_error');
        const $inputOutline = $input.closest('.form__col input');

        if ($inputError) {
          $inputOutline.classList.remove('outline-red-500');
          $inputWrapper.classList.remove('has-error');
          $inputError.remove();
          hasErrors = hasErrors - 1;
        }
      }

      function isDateValid(month, year) {
        let y = curYear;
        if (year > 99) y = curYear + 2000;
        return year > y || (year === y && month > curMonth);
      }
      const isValidLuhn = (cardNumber) => {
        const digits = cardNumber.replace(/\D/g, '').split('').reverse();
        return (
          digits.reduce((sum, digit, index) => {
            let n = parseInt(digit, 10);
            if (index % 2 !== 0) n *= 2;
            if (n > 9) n -= 9;
            return sum + n;
          }, 0) %
            10 ===
          0
        );
      };
      const app = {
        init: function () {
          this.cardTypeListener();
          this.inputListener();
          this.expirationDateListener();
        },

        cardTypeListener: function () {
          const cardNumber = document.querySelector('.number-input');
          if (cardNumber) {
            cardNumberMask = new IMask(cardNumber, {
              mask: [
                {
                  mask: '0000 0000 0000 0000',
                  regex: '^4\d{0,15}',
                  cardtype: 'visa',
                },
                {
                  mask: '0000 0000 0000 0000',
                  regex:
                    '^(5[1-5]\d{0,14}|(222[1-9]|22[3-9]\d|2[3-6]\d{2}|27[01]\d|2720)\d{0,12})',
                  cardtype: 'mastercard',
                },
                {
                  mask: '0000 0000 0000 0000',
                  regex: '^6(?:011|5\d{2})\d{0,12}',
                  cardtype: 'discover',
                },
                {
                  mask: '0000 0000 0000 0000',
                  regex: '^(62|81)\d{0,14}',
                  cardtype: 'unionpay',
                },
                {
                  mask: '0000 0000 0000 0000',
                  regex: '^35\d{0,14}',
                  cardtype: 'jcb',
                },
                {
                  mask: '0000 0000 0000 0000',
                  regex: '^62[0-9]{0,14}',
                  cardtype: 'chinaunionpay',
                },
                {
                  mask: '0000 0000 0000 0000',
                  regex: '^1\d{0,15}',
                  cardtype: 'uatp',
                },
                {
                  mask: '0000 0000 0000 0000',
                  regex: 'd{0,15}',
                  cardtype: '',
                },
              ],
              dispatch: function (appended, dynamicMasked) {
                let number = (dynamicMasked.value + appended).replace(
                  /\D/g,
                  ''
                );
                for (let i = 0; i < dynamicMasked.compiledMasks.length; i++) {
                  let re = new RegExp(dynamicMasked.compiledMasks[i].regex);
                  if (number.match(re) != null) {
                    return dynamicMasked.compiledMasks[i];
                  }
                }
              },
            });

            cardNumberMask.on('accept', function () {
              if (cardNumberMask.value.length == 0) {
                cardNumber.removeAttribute('data-card-type');
              } else {
                cardNumber.setAttribute(
                  'data-card-type',
                  cardNumberMask.masked.currentMask.cardtype
                );
              }
            });
          }
        },

        inputListener: function () {
          let expDatePrevLength = 0;

          const $inputs = getElementsArray('.form__input');
          $inputs.forEach(inputsIterator);

          function inputsIterator($input) {
            function setDisplayBlock(image) {
              image.style.display = 'block';
              // add
              if (window.innerWidth <= 767) {
                image.style.display = 'block';
                setTimeout(function () {
                  image.style.display = 'none';
                  image.style.removeProperty('opacity');
                }, 2000);
              }
            }

            function setDisplayNone(image) {
              image.style.display = 'none';
            }

            function showImages(inputId) {
              getElementsArray('.image_' + inputId).forEach(setDisplayBlock);
            }

            function showImagesMobile(inputId) {
              getElementsArray('.image-mobile .image_' + inputId).forEach(
                setDisplayBlock
              );
            }

            function hideImages(inputId) {
              const inputs = inputId
                ? getElementsArray('.image_' + inputId)
                : getElementsArray('.card__step');

              inputs.forEach(setDisplayNone);
            }

            function showCardImage(inputId) {
              hideImages();
              showImages(inputId || $input.id);
            }

            // $input.addEventListener('focus', onFocusListener);

            // function onFocusListener() {
            //   showCardImage();

            //   if ($input.id === 'cardnr') {
            //     $input.value = $input.value.replace(/(\d{4})(?=.)/gi, '$1 ');
            //     cardNumberMask.updateValue();
            //   }
            // }

            function checkError(event) {
              const requiredLength = inputProperties[$input.id].requiredLength;
              const errors = inputProperties[$input.id].errors;
              const length = $input.value.length;
              let errorText = '';

              if (length === 0) {
                showError($input, errors.required);
                return;
              }

              const expDate = $input.value.split('/');
              const expMonth = parseInt(expDate[0], 10);
              const expYear = parseInt(expDate[1], 10);

              if (length > 0) {
                $input.closest('.form__col').classList.add('has-value');
              }
              if ($input.id === 'expiryDate') {
                if (
                  length === 2 &&
                  expDatePrevLength !== 3 &&
                  event.code !== 'Backspace'
                ) {
                  $input.value += '/';
                } else if (length === 3 && expDatePrevLength > 3) {
                  $input.value = $input.value.substring(0, 2);
                }

                const isValid =
                  Boolean(expMonth) &&
                  Boolean(expYear) &&
                  isDateValid(expMonth, expYear);
                // const shouldFocusOnNextField =
                //   isValid &&
                //   (expDatePrevLength === 4 || expDatePrevLength === 6);

                // if (shouldFocusOnNextField) {
                //   $inputs[3].focus();
                //   showCardImage($inputs[3].id);
                // }

                // if (
                //   (event.type === 'blur' && length > requiredLength) ||
                //   shouldFocusOnNextField
                // ) {
                //   $input.value = $input.value.replace('/20', '/errors');
                // }

                updateExpDateValue(expMonth, expYear);
                expirationDateMask.updateValue();
                expDatePrevLength = $input.value.length;

                if (!isValid && length >= requiredLength) {
                  errorText = errors.value;
                }
              }

              if (!errorText && requiredLength && length < requiredLength) {
                errorText = errors.length;
              }
              if ($input.id === 'cardnr') {
                const $inputs = getElementsArray('.form__input');
                $cardInput = $inputs[1];
                const cardNumber = document.querySelector('.number-input');
                const cleanNumber = cardNumberMask.unmaskedValue;

                if (cleanNumber.length >= 16 && isValidLuhn(cleanNumber)) {
                  hideError($cardInput);
                } else {
                  errorText = errors.invalid;
                }
              }

              if (errorText) showError($input, errorText);
              else hideError($input);
            }

            function updateExpDateValue(expMonth, expYear) {
              const yearInput = document.querySelector('#validYEAR');
              const monthInput = document.querySelector('#validMONTH');
              let year = '';

              if (expYear > 1000) year = expYear.toString().substring(2);
              else if (expYear < 100) year = expYear.toString();

              monthInput.value = expMonth > 9 ? expMonth : '0' + expMonth;
              yearInput.value = year;
            }

            $input.addEventListener('keyup', checkError);
            // $input.addEventListener('blur', onBlurListener);

            function onBlurListener(event) {
              checkError(event);
              hideImages();

              // if ($input.id === 'cardnr') {
              //   $input.value = $input.value.replace(/\s/gi, '');
              //   cardNumberMask.updateValue();
              // }
            }
          }

          // const $input_labels = getElementsArray('.label');

          // $input_labels.forEach(labelIterator);

          // function labelIterator($label) {
          //   function clickListener() {
          //     $label.previousElementSibling.focus();
          //   }

          //   $label.addEventListener('click', clickListener);
          // }
        },

        expirationDateListener: function () {
          const expirationDate = document.querySelector('.expiry-input');

          if (!expirationDate) return;

          expirationDateMask = new IMask(expirationDate, {
            mask: 'MM{/}YY',
            blocks: {
              YY: {
                mask: '0000',
                regex: '^[2]\\d{1, 3}',
              },
              MM: {
                mask: IMask.MaskedRange,
                from: 1,
                to: 12,
              },
            },
          });
        },
      };

      document.addEventListener('DOMContentLoaded', function () {
        app.init();

        const btn = document.getElementById('submit_button');
        const cardInput = document.getElementById('cardnr');
        btn.addEventListener('click', function (e) {
          if (!hasErrors) cardInput.value = cardInput.value.replace(/\s/gi, '');
          if (hasErrors) e.preventDefault();
        });
      });
    </script>

    <script type="text/javascript">
      document.addEventListener('DOMContentLoaded', function () {
        const oneClick = document.querySelector('.one_click');
        const byCard = document.querySelector('.by_card');
        const byCardButton = document.querySelector('.by_card_button');
        const backButton = document.querySelector('.back_button');
        const appleButton = document.getElementById('applebutton');
        const googlePayButton = document.getElementById('google-pay-button');
        const saveCardElement = document.getElementById('save_card');
        const isServer3dsApplePayFunctionPresent =
          typeof Server3dsApplePay === 'function';
        const googlePayScript = document.querySelector(
          'script[onload="googlePay.onGooglePayLoaded()"]'
        );
        const mainBlockBody = document.querySelector('.main__block_body');

        setTimeout(function () {
          if (mainBlockBody) {
            mainBlockBody.style.opacity = '1';
          }
        }, 200);

        if (window.ApplePaySession && isServer3dsApplePayFunctionPresent) {
          appleButton.style.display = 'block';
        }

        if (
          (!window.ApplePaySession && !googlePayScript.getAttribute('src')) ||
          (!isServer3dsApplePayFunctionPresent &&
            !googlePayScript.getAttribute('src'))
        ) {
          oneClick.classList.remove('visible');
          byCard.classList.add('visible');
        }

        if (saveCardElement) {
          const saveCardClassElement = document.querySelector('.save_card');

          if (saveCardClassElement) {
            saveCardClassElement.style.display = 'block';
          }
        }

        byCardButton.addEventListener('click', function (event) {
          event.preventDefault();
          if (oneClick.classList.contains('visible')) {
            oneClick.classList.remove('visible');
            byCard.classList.add('visible');
            backButton.classList.add('visible');
          }
        });

        backButton.addEventListener('click', function (event) {
          event.preventDefault();
          if (byCard.classList.contains('visible')) {
            byCard.classList.remove('visible');
            oneClick.classList.add('visible');
            backButton.classList.remove('visible');
          }
        });
      });
    </script>

    <script
      src="%%googlepay_web_sdk_url%%"
      onLoad="googlePay.onGooglePayLoaded()"
    ></script>

    <script defer async>
      !(function (d) {
        if (!d.currentScript) {
          console.log('IE only polyfills!');
          var s = d.createElement('script');
          s.src = 'images/maib/js/polyfill.js';
          d.head.appendChild(s);
        }
      })(document);
    </script>
    <script>
      document.addEventListener('click', function (event) {
        if (!event.target.closest('input, button, select, textarea')) {
          document.activeElement.blur();
        }
      });
    </script>
  </body>
</html>
